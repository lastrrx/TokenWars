<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TokenWars Advanced Admin Panel - Phase 2</title>
    <link rel="stylesheet" href="admin.css">

    <!-- Supabase Client -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* Enhanced Phase 2 Styles */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 5000;
            color: #f1f5f9;
            font-size: 1.125rem;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(139, 92, 246, 0.3);
            border-top: 4px solid #8b5cf6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .admin-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(31, 41, 55, 0.95);
            border: 1px solid;
            border-radius: 0.5rem;
            padding: 1rem 1.5rem;
            color: #f3f4f6;
            z-index: 4000;
            min-width: 300px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .admin-notification.success { border-color: #22c55e; }
        .admin-notification.error { border-color: #ef4444; }
        .admin-notification.warning { border-color: #f59e0b; }
        .admin-notification.info { border-color: #3b82f6; }

        .admin-notification button {
            background: none;
            border: none;
            color: #9ca3af;
            font-size: 1.2rem;
            cursor: pointer;
            margin-left: 1rem;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }

        .status-indicator.healthy { background: #22c55e; }
        .status-indicator.error { background: #ef4444; }
        .status-indicator.stale { background: #f59e0b; }
        .status-indicator.unknown { background: #6b7280; }

        /* Phase 2 Enhanced Sections */
        .phase2-section {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(59, 130, 246, 0.1));
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            position: relative;
        }

        .phase2-badge {
            position: absolute;
            top: -8px;
            right: 1rem;
            background: linear-gradient(135deg, #8b5cf6, #3b82f6);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .cache-health-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .cache-health-card {
            background: var(--admin-surface);
            border: 1px solid var(--admin-border);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }

        .cache-metric {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .cache-metric.excellent { color: #22c55e; }
        .cache-metric.good { color: #3b82f6; }
        .cache-metric.warning { color: #f59e0b; }
        .cache-metric.critical { color: #ef4444; }

        .cache-controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }

        .approval-queue {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--admin-border);
            border-radius: 8px;
        }

        .approval-item {
            padding: 1rem;
            border-bottom: 1px solid var(--admin-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .approval-item:last-child {
            border-bottom: none;
        }

        .approval-item:hover {
            background: rgba(139, 92, 246, 0.05);
        }

        .approval-token-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .approval-token-logo {
            width: 32px;
            height: 32px;
            border-radius: 50%;
        }

        .approval-actions {
            display: flex;
            gap: 0.5rem;
        }

        .blacklist-category {
            background: var(--admin-surface);
            border: 1px solid var(--admin-border);
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .blacklist-header {
            padding: 1rem;
            border-bottom: 1px solid var(--admin-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .blacklist-count {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            padding: 0.25rem 0.5rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .blacklist-items {
            max-height: 300px;
            overflow-y: auto;
        }

        .blacklist-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--admin-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .blacklist-item:last-child {
            border-bottom: none;
        }

        .optimization-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .optimization-control {
            background: var(--admin-surface);
            border: 1px solid var(--admin-border);
            border-radius: 8px;
            padding: 1rem;
        }

        .optimization-control label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--admin-text-secondary);
        }

        .optimization-slider {
            width: 100%;
            margin-bottom: 0.5rem;
        }

        .optimization-value {
            text-align: center;
            font-size: 0.875rem;
            color: var(--admin-primary);
            font-weight: 600;
        }

        .performance-chart {
            background: var(--admin-surface);
            border: 1px solid var(--admin-border);
            border-radius: 8px;
            padding: 1rem;
            height: 300px;
            margin-bottom: 1rem;
        }

        .job-queue {
            background: var(--admin-surface);
            border: 1px solid var(--admin-border);
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
        }

        .job-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--admin-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .job-item:last-child {
            border-bottom: none;
        }

        .job-status {
            padding: 0.25rem 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .job-status.running { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .job-status.pending { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        .job-status.failed { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .job-status.completed { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: var(--admin-border);
            border-radius: 3px;
            overflow: hidden;
            margin: 0.5rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #8b5cf6, #3b82f6);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .batch-selector {
            background: var(--admin-bg);
            border: 1px solid var(--admin-border);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .batch-controls {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .algorithm-tuning {
            background: var(--admin-surface);
            border: 1px solid var(--admin-border);
            border-radius: 8px;
            padding: 1rem;
        }

        .tuning-section {
            margin-bottom: 1.5rem;
        }

        .tuning-section h4 {
            margin-bottom: 0.75rem;
            color: var(--admin-primary);
        }

        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .metric-item {
            text-align: center;
            padding: 0.75rem;
            background: var(--admin-bg);
            border-radius: 6px;
        }

        .metric-item .value {
            font-size: 1.125rem;
            font-weight: bold;
            color: var(--admin-text);
        }

        .metric-item .label {
            font-size: 0.75rem;
            color: var(--admin-text-secondary);
        }

        /* Responsive Phase 2 */
        @media (max-width: 768px) {
            .phase2-section {
                padding: 1rem;
            }
            
            .cache-controls {
                flex-direction: column;
            }
            
            .cache-health-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .optimization-controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Admin Authentication Screen -->
    <div id="auth-screen" class="auth-container">
        <div class="auth-box">
            <h1>üöÄ TokenWars Advanced Admin Panel</h1>
            <p class="auth-description">Phase 2: Advanced Token Administration & Cache Management</p>
            
            <div class="auth-steps">
                <div class="auth-step" id="step-wallet">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h3>Connect Admin Wallet</h3>
                        <button id="connect-admin-wallet" class="btn btn-primary">
                            Connect Wallet
                        </button>
                        <div id="wallet-status" class="wallet-status hidden">
                            <span class="wallet-address"></span>
                            <span class="status-icon">‚úì</span>
                        </div>
                    </div>
                </div>
                
                <div class="auth-step disabled" id="step-pin">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h3>Enter Admin PIN</h3>
                        <input type="password" id="admin-pin" placeholder="Enter 6-digit PIN" 
                               maxlength="6" pattern="[0-9]{6}" disabled>
                        <button id="verify-pin" class="btn btn-primary" disabled>
                            Verify Access
                        </button>
                    </div>
                </div>
            </div>
            
            <div id="auth-error" class="error-message hidden"></div>
        </div>
    </div>

    <!-- Main Admin Panel -->
    <div id="admin-panel" class="admin-panel hidden">
        <!-- Enhanced Admin Header -->
        <header class="admin-header">
            <div class="header-container">
                <h1>üèÜ TokenWars Advanced Admin - Phase 2</h1>
                <div class="header-actions">
                    <div class="real-time-indicator">
                        <div class="real-time-pulse"></div>
                        <span>Live Data</span>
                    </div>
                    <div id="token-update-status" class="token-update-status">
                        <span class="status-indicator unknown"></span>
                        <span>Token Status: Loading...</span>
                    </div>
                    <span class="admin-wallet"></span>
                    <button id="logout" class="btn btn-secondary">Logout</button>
                </div>
            </div>
        </header>

        <!-- Enhanced Admin Navigation -->
        <nav class="admin-nav">
            <ul class="nav-menu">
                <li><a href="#dashboard" class="nav-item active">üìä Dashboard</a></li>
                <li><a href="#cache-management" class="nav-item">üîß Cache Management</a></li>
                <li><a href="#token-approval" class="nav-item">‚úÖ Token Approval</a></li>
                <li><a href="#blacklist-management" class="nav-item">üö´ Blacklist Management</a></li>
                <li><a href="#pair-optimization" class="nav-item">‚ö° Pair Optimization</a></li>
                <li><a href="#competitions" class="nav-item">üèÅ Competitions</a></li>
                <li><a href="#tokens" class="nav-item">ü™ô Token Management</a></li>
                <li><a href="#analytics" class="nav-item">üìà Analytics</a></li>
            </ul>
        </nav>

        <!-- Enhanced Admin Content -->
        <main class="admin-content">
            <!-- Enhanced Dashboard Section -->
            <section id="dashboard" class="admin-section">
                <h2>üéõÔ∏è Advanced System Dashboard</h2>
                
                <!-- Enhanced Key Metrics -->
                <div class="metrics-grid" id="dashboard-metrics">
                    <div class="metric-card">
                        <h3>üí∞ Total Volume</h3>
                        <p class="metric-value" id="total-volume">0 SOL</p>
                        <p class="metric-change positive">+12.5%</p>
                    </div>
                    <div class="metric-card">
                        <h3>üèÉ Active Competitions</h3>
                        <p class="metric-value" id="active-competitions">0</p>
                        <p class="metric-change positive">+5.2%</p>
                    </div>
                    <div class="metric-card">
                        <h3>ü™ô Total Tokens</h3>
                        <p class="metric-value" id="total-tokens">0</p>
                        <p class="metric-change positive">+8.7%</p>
                    </div>
                    <div class="metric-card">
                        <h3>‚úÖ Active Tokens</h3>
                        <p class="metric-value" id="active-tokens">0</p>
                        <p class="metric-change">Real-time</p>
                    </div>
                    <div class="metric-card">
                        <h3>üìä Total Market Cap</h3>
                        <p class="metric-value" id="total-market-cap">$0</p>
                        <p class="metric-change positive">+15.3%</p>
                    </div>
                    <div class="metric-card">
                        <h3>üîÑ Cache Hit Rate</h3>
                        <p class="metric-value" id="cache-hit-rate">94.2%</p>
                        <p class="metric-change positive">Optimal</p>
                    </div>
                </div>

                <!-- Enhanced System Status -->
                <div class="system-status">
                    <h3>üîß System Health Status</h3>
                    <div class="status-grid">
                        <!-- Status items will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Phase 2 Quick Actions -->
                <div class="phase2-section">
                    <div class="phase2-badge">Phase 2</div>
                    <h3>‚ö° Quick Actions</h3>
                    <div class="cache-controls">
                        <button class="btn btn-primary" onclick="quickCacheRefresh()">
                            üîÑ Quick Cache Refresh
                        </button>
                        <button class="btn btn-secondary" onclick="viewPendingApprovals()">
                            ‚úÖ View Pending Approvals (<span id="pending-count">0</span>)
                        </button>
                        <button class="btn btn-warning" onclick="reviewBlacklist()">
                            üö´ Review Blacklist
                        </button>
                        <button class="btn btn-success" onclick="optimizePairs()">
                            ‚ö° Optimize Pairs
                        </button>
                    </div>
                </div>

                <!-- Enhanced Recent Activity -->
                <div class="recent-activity">
                    <h3>üìù Recent Activity</h3>
                    <div id="activity-feed" class="activity-feed">
                        <!-- Activity items will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- NEW: Cache Management Section -->
            <section id="cache-management" class="admin-section hidden">
                <h2>üîß Advanced Cache Management</h2>
                
                <!-- Cache Health Overview -->
                <div class="phase2-section">
                    <div class="phase2-badge">Real-time</div>
                    <h3>üìä Cache Health Overview</h3>
                    <div class="cache-health-grid">
                        <div class="cache-health-card">
                            <div class="cache-metric excellent" id="token-cache-hit">94.2%</div>
                            <div class="label">Token Cache Hit Rate</div>
                        </div>
                        <div class="cache-health-card">
                            <div class="cache-metric excellent" id="price-cache-hit">97.8%</div>
                            <div class="label">Price Cache Hit Rate</div>
                        </div>
                        <div class="cache-health-card">
                            <div class="cache-metric good" id="avg-response-time">45ms</div>
                            <div class="label">Avg Response Time</div>
                        </div>
                        <div class="cache-health-card">
                            <div class="cache-metric warning" id="cache-size">12.4MB</div>
                            <div class="label">Total Cache Size</div>
                        </div>
                    </div>
                </div>

                <!-- Manual Cache Controls -->
                <div class="phase2-section">
                    <h3>üõ†Ô∏è Manual Cache Controls</h3>
                    <div class="cache-controls">
                        <button class="btn btn-primary" onclick="refreshTokenCache()">
                            ü™ô Refresh Token Cache
                        </button>
                        <button class="btn btn-primary" onclick="refreshPriceCache()">
                            üí∞ Refresh Price Cache
                        </button>
                        <button class="btn btn-secondary" onclick="invalidateCache('selective')">
                            üéØ Selective Invalidation
                        </button>
                        <button class="btn btn-warning" onclick="invalidateCache('all')">
                            üóëÔ∏è Clear All Cache
                        </button>
                        <button class="btn btn-success" onclick="optimizeCache()">
                            ‚ö° Optimize Cache
                        </button>
                    </div>
                    
                    <!-- Cache Progress Indicator -->
                    <div id="cache-progress" class="hidden">
                        <h4>Cache Operation Progress</h4>
                        <div class="progress-bar">
                            <div class="progress-fill" id="cache-progress-bar" style="width: 0%"></div>
                        </div>
                        <div id="cache-progress-text">Initializing...</div>
                    </div>
                </div>

                <!-- Background Job Management -->
                <div class="phase2-section">
                    <h3>‚öôÔ∏è Background Job Management</h3>
                    <div class="cache-controls">
                        <button class="btn btn-success" onclick="startBackgroundJobs()">
                            ‚ñ∂Ô∏è Start Jobs
                        </button>
                        <button class="btn btn-warning" onclick="pauseBackgroundJobs()">
                            ‚è∏Ô∏è Pause Jobs
                        </button>
                        <button class="btn btn-danger" onclick="stopBackgroundJobs()">
                            ‚èπÔ∏è Stop Jobs
                        </button>
                        <button class="btn btn-secondary" onclick="viewJobLogs()">
                            üìã View Logs
                        </button>
                    </div>
                    
                    <!-- Job Queue Status -->
                    <h4>üìã Active Job Queue</h4>
                    <div class="job-queue" id="job-queue">
                        <!-- Job items will be populated here -->
                    </div>
                </div>

                <!-- Cache Analytics -->
                <div class="phase2-section">
                    <h3>üìà Cache Performance Analytics</h3>
                    <div class="performance-chart">
                        <canvas id="cache-performance-chart"></canvas>
                    </div>
                    <div class="performance-metrics">
                        <div class="metric-item">
                            <div class="value" id="daily-requests">2.4M</div>
                            <div class="label">Daily Requests</div>
                        </div>
                        <div class="metric-item">
                            <div class="value" id="cache-savings">$127</div>
                            <div class="label">API Cost Savings</div>
                        </div>
                        <div class="metric-item">
                            <div class="value" id="efficiency-score">94.2%</div>
                            <div class="label">Efficiency Score</div>
                        </div>
                        <div class="metric-item">
                            <div class="value" id="uptime">99.97%</div>
                            <div class="label">Cache Uptime</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- NEW: Token Approval Section -->
            <section id="token-approval" class="admin-section hidden">
                <h2>‚úÖ Token Approval Workflow</h2>
                
                <!-- Approval Statistics -->
                <div class="phase2-section">
                    <h3>üìä Approval Statistics</h3>
                    <div class="cache-health-grid">
                        <div class="cache-health-card">
                            <div class="cache-metric good" id="pending-approvals">12</div>
                            <div class="label">Pending Approvals</div>
                        </div>
                        <div class="cache-health-card">
                            <div class="cache-metric excellent" id="approval-rate">87.3%</div>
                            <div class="label">Approval Rate</div>
                        </div>
                        <div class="cache-health-card">
                            <div class="cache-metric good" id="avg-review-time">2.4h</div>
                            <div class="label">Avg Review Time</div>
                        </div>
                        <div class="cache-health-card">
                            <div class="cache-metric warning" id="auto-approved">45%</div>
                            <div class="label">Auto-Approved</div>
                        </div>
                    </div>
                </div>

                <!-- Batch Operations -->
                <div class="batch-selector">
                    <h3>üîÑ Batch Operations</h3>
                    <div class="batch-controls">
                        <button class="btn btn-success" onclick="batchApprove()">
                            ‚úÖ Approve Selected
                        </button>
                        <button class="btn btn-danger" onclick="batchReject()">
                            ‚ùå Reject Selected
                        </button>
                        <button class="btn btn-secondary" onclick="selectAll()">
                            üóÇÔ∏è Select All
                        </button>
                        <button class="btn btn-secondary" onclick="clearSelection()">
                            üóëÔ∏è Clear Selection
                        </button>
                        <button class="btn btn-primary" onclick="bulkAnalyze()">
                            üîç Bulk Analyze
                        </button>
                    </div>
                    <div class="selected-count">
                        Selected: <span id="selected-count">0</span> tokens
                    </div>
                </div>

                <!-- Pending Approval Queue -->
                <div class="phase2-section">
                    <h3>‚è≥ Pending Approval Queue</h3>
                    <div class="approval-queue" id="approval-queue">
                        <!-- Approval items will be populated here -->
                    </div>
                </div>

                <!-- Auto-Approval Rules Configuration -->
                <div class="phase2-section">
                    <h3>ü§ñ Auto-Approval Rules</h3>
                    <div class="optimization-controls">
                        <div class="optimization-control">
                            <label>Minimum Market Cap ($M)</label>
                            <input type="range" class="optimization-slider" 
                                   id="min-market-cap" min="1" max="100" value="5">
                            <div class="optimization-value" id="min-market-cap-value">$5M</div>
                        </div>
                        <div class="optimization-control">
                            <label>Minimum Age (days)</label>
                            <input type="range" class="optimization-slider" 
                                   id="min-age" min="1" max="365" value="30">
                            <div class="optimization-value" id="min-age-value">30 days</div>
                        </div>
                        <div class="optimization-control">
                            <label>Minimum Liquidity Score</label>
                            <input type="range" class="optimization-slider" 
                                   id="min-liquidity" min="0" max="100" value="30">
                            <div class="optimization-value" id="min-liquidity-value">30%</div>
                        </div>
                        <div class="optimization-control">
                            <label>Verification Required</label>
                            <select id="verification-required" class="form-control">
                                <option value="false">No</option>
                                <option value="true">Yes</option>
                                <option value="preferred">Preferred</option>
                            </select>
                        </div>
                    </div>
                    <div class="cache-controls">
                        <button class="btn btn-primary" onclick="saveAutoApprovalRules()">
                            üíæ Save Rules
                        </button>
                        <button class="btn btn-secondary" onclick="testAutoApprovalRules()">
                            üß™ Test Rules
                        </button>
                        <button class="btn btn-warning" onclick="resetAutoApprovalRules()">
                            üîÑ Reset to Defaults
                        </button>
                    </div>
                </div>
            </section>

            <!-- NEW: Blacklist Management Section -->
            <section id="blacklist-management" class="admin-section hidden">
                <h2>üö´ Enhanced Blacklist Management</h2>
                
                <!-- Blacklist Overview -->
                <div class="phase2-section">
                    <h3>üìä Blacklist Overview</h3>
                    <div class="cache-health-grid">
                        <div class="cache-health-card">
                            <div class="cache-metric warning" id="total-blacklisted">47</div>
                            <div class="label">Total Blacklisted</div>
                        </div>
                        <div class="cache-health-card">
                            <div class="cache-metric good" id="auto-detected">12</div>
                            <div class="label">Auto-Detected</div>
                        </div>
                        <div class="cache-health-card">
                            <div class="cache-metric excellent" id="detection-accuracy">96.8%</div>
                            <div class="label">Detection Accuracy</div>
                        </div>
                        <div class="cache-health-card">
                            <div class="cache-metric good" id="appeals-pending">3</div>
                            <div class="label">Appeals Pending</div>
                        </div>
                    </div>
                </div>

                <!-- Detection Algorithm Configuration -->
                <div class="phase2-section">
                    <h3>ü§ñ Detection Algorithm Configuration</h3>
                    <div class="optimization-controls">
                        <div class="optimization-control">
                            <label>Rugpull Detection Sensitivity</label>
                            <input type="range" class="optimization-slider" 
                                   id="rugpull-sensitivity" min="0" max="100" value="75">
                            <div class="optimization-value" id="rugpull-sensitivity-value">High</div>
                        </div>
                        <div class="optimization-control">
                            <label>Scam Detection Sensitivity</label>
                            <input type="range" class="optimization-slider" 
                                   id="scam-sensitivity" min="0" max="100" value="60">
                            <div class="optimization-value" id="scam-sensitivity-value">Medium</div>
                        </div>
                        <div class="optimization-control">
                            <label>Honeypot Analysis</label>
                            <select id="honeypot-analysis" class="form-control">
                                <option value="enabled">Enabled</option>
                                <option value="disabled">Disabled</option>
                                <option value="manual">Manual Only</option>
                            </select>
                        </div>
                        <div class="optimization-control">
                            <label>Duplicate Name Detection</label>
                            <select id="duplicate-detection" class="form-control">
                                <option value="strict">Strict</option>
                                <option value="moderate">Moderate</option>
                                <option value="lenient">Lenient</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Blacklist Categories -->
                <div class="phase2-section">
                    <h3>üìÇ Blacklist Categories</h3>
                    
                    <!-- Manual Blacklist -->
                    <div class="blacklist-category">
                        <div class="blacklist-header">
                            <h4>üë®‚Äçüíº Manual Blacklist</h4>
                            <div class="blacklist-count" id="manual-blacklist-count">23</div>
                        </div>
                        <div class="blacklist-items" id="manual-blacklist">
                            <!-- Items will be populated here -->
                        </div>
                    </div>

                    <!-- Automatic Blacklist -->
                    <div class="blacklist-category">
                        <div class="blacklist-header">
                            <h4>ü§ñ Auto-Detected</h4>
                            <div class="blacklist-count" id="auto-blacklist-count">12</div>
                        </div>
                        <div class="blacklist-items" id="auto-blacklist">
                            <!-- Items will be populated here -->
                        </div>
                    </div>

                    <!-- Community Reports -->
                    <div class="blacklist-category">
                        <div class="blacklist-header">
                            <h4>üë• Community Reported</h4>
                            <div class="blacklist-count" id="community-blacklist-count">8</div>
                        </div>
                        <div class="blacklist-items" id="community-blacklist">
                            <!-- Items will be populated here -->
                        </div>
                    </div>

                    <!-- Appeals -->
                    <div class="blacklist-category">
                        <div class="blacklist-header">
                            <h4>‚öñÔ∏è Appeals</h4>
                            <div class="blacklist-count" id="appeals-count">4</div>
                        </div>
                        <div class="blacklist-items" id="appeals-list">
                            <!-- Items will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Bulk Operations -->
                <div class="phase2-section">
                    <h3>üîÑ Bulk Operations</h3>
                    <div class="cache-controls">
                        <button class="btn btn-danger" onclick="bulkBlacklist()">
                            üö´ Bulk Blacklist
                        </button>
                        <button class="btn btn-success" onclick="bulkWhitelist()">
                            ‚úÖ Bulk Whitelist
                        </button>
                        <button class="btn btn-warning" onclick="reviewAppeals()">
                            ‚öñÔ∏è Review Appeals
                        </button>
                        <button class="btn btn-secondary" onclick="exportBlacklist()">
                            üì§ Export Blacklist
                        </button>
                        <button class="btn btn-primary" onclick="scanForThreats()">
                            üîç Scan for New Threats
                        </button>
                    </div>
                </div>
            </section>

            <!-- NEW: Pair Optimization Section -->
            <section id="pair-optimization" class="admin-section hidden">
                <h2>‚ö° Token Pair Optimization Engine</h2>
                
                <!-- Optimization Overview -->
                <div class="phase2-section">
                    <h3>üìä Optimization Overview</h3>
                    <div class="cache-health-grid">
                        <div class="cache-health-card">
                            <div class="cache-metric excellent" id="pair-success-rate">94.2%</div>
                            <div class="label">Pair Success Rate</div>
                        </div>
                        <div class="cache-health-card">
                            <div class="cache-metric good" id="avg-engagement">78.5%</div>
                            <div class="label">Avg Engagement</div>
                        </div>
                        <div class="cache-health-card">
                            <div class="cache-metric warning" id="active-pairs">15</div>
                            <div class="label">Active Pairs</div>
                        </div>
                        <div class="cache-health-card">
                            <div class="cache-metric excellent" id="revenue-per-pair">$42.30</div>
                            <div class="label">Revenue per Pair</div>
                        </div>
                    </div>
                </div>

                <!-- Algorithm Tuning -->
                <div class="algorithm-tuning">
                    <h3>üéõÔ∏è Algorithm Tuning</h3>
                    
                    <div class="tuning-section">
                        <h4>üìä Market Cap Matching</h4>
                        <div class="optimization-controls">
                            <div class="optimization-control">
                                <label>Market Cap Tolerance (%)</label>
                                <input type="range" class="optimization-slider" 
                                       id="market-cap-tolerance" min="5" max="50" value="10">
                                <div class="optimization-value" id="market-cap-tolerance-value">10%</div>
                            </div>
                            <div class="optimization-control">
                                <label>Liquidity Minimum (%)</label>
                                <input type="range" class="optimization-slider" 
                                       id="liquidity-minimum" min="10" max="90" value="30">
                                <div class="optimization-value" id="liquidity-minimum-value">30%</div>
                            </div>
                        </div>
                    </div>

                    <div class="tuning-section">
                        <h4>üéØ Preference Weights</h4>
                        <div class="optimization-controls">
                            <div class="optimization-control">
                                <label>New Token Priority</label>
                                <input type="range" class="optimization-slider" 
                                       id="new-token-priority" min="0" max="100" value="25">
                                <div class="optimization-value" id="new-token-priority-value">25%</div>
                            </div>
                            <div class="optimization-control">
                                <label>Balanced Exposure</label>
                                <input type="range" class="optimization-slider" 
                                       id="balanced-exposure" min="0" max="100" value="75">
                                <div class="optimization-value" id="balanced-exposure-value">75%</div>
                            </div>
                            <div class="optimization-control">
                                <label>Community Interest Weight</label>
                                <input type="range" class="optimization-slider" 
                                       id="community-weight" min="0" max="100" value="40">
                                <div class="optimization-value" id="community-weight-value">40%</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Performance Analytics -->
                <div class="phase2-section">
                    <h3>üìà Pair Performance Analytics</h3>
                    <div class="performance-chart">
                        <canvas id="pair-performance-chart"></canvas>
                    </div>
                    <div class="performance-metrics">
                        <div class="metric-item">
                            <div class="value" id="total-pairs-generated">247</div>
                            <div class="label">Pairs Generated</div>
                        </div>
                        <div class="metric-item">
                            <div class="value" id="successful-pairs">233</div>
                            <div class="label">Successful Pairs</div>
                        </div>
                        <div class="metric-item">
                            <div class="value" id="avg-pair-duration">18.7h</div>
                            <div class="label">Avg Duration</div>
                        </div>
                        <div class="metric-item">
                            <div class="value" id="user-satisfaction">89.2%</div>
                            <div class="label">User Satisfaction</div>
                        </div>
                    </div>
                </div>

                <!-- Manual Pair Generation -->
                <div class="phase2-section">
                    <h3>üõ†Ô∏è Manual Pair Generation</h3>
                    <div class="cache-controls">
                        <button class="btn btn-primary" onclick="generateOptimalPairs()">
                            ‚ö° Generate Optimal Pairs
                        </button>
                        <button class="btn btn-secondary" onclick="testPairCombination()">
                            üß™ Test Combination
                        </button>
                        <button class="btn btn-success" onclick="saveOptimizationSettings()">
                            üíæ Save Settings
                        </button>
                        <button class="btn btn-warning" onclick="resetToDefaults()">
                            üîÑ Reset to Defaults
                        </button>
                        <button class="btn btn-info" onclick="runABTest()">
                            üéØ Run A/B Test
                        </button>
                    </div>
                </div>

                <!-- Community Feedback Integration -->
                <div class="phase2-section">
                    <h3>üë• Community Feedback Integration</h3>
                    <div class="optimization-controls">
                        <div class="optimization-control">
                            <label>Feedback Weight in Algorithm</label>
                            <input type="range" class="optimization-slider" 
                                   id="feedback-weight" min="0" max="100" value="30">
                            <div class="optimization-value" id="feedback-weight-value">30%</div>
                        </div>
                        <div class="optimization-control">
                            <label>Minimum Feedback Count</label>
                            <input type="range" class="optimization-slider" 
                                   id="min-feedback-count" min="1" max="100" value="10">
                            <div class="optimization-value" id="min-feedback-count-value">10 votes</div>
                        </div>
                    </div>
                    <div class="cache-controls">
                        <button class="btn btn-secondary" onclick="viewFeedbackData()">
                            üìä View Feedback Data
                        </button>
                        <button class="btn btn-primary" onclick="integrateFeedback()">
                            üîÑ Integrate Feedback
                        </button>
                    </div>
                </div>
            </section>

            <!-- Enhanced Competitions Section -->
            <section id="competitions" class="admin-section hidden">
                <h2>üèÅ Enhanced Competition Management</h2>
                
                <!-- Competition Statistics -->
                <div class="tokens-section">
                    <h3>üìä Competition Overview</h3>
                    <div class="token-stats-grid">
                        <div class="token-stat-card">
                            <div class="token-stat-value" id="total-competitions-stat">0</div>
                            <div class="token-stat-label">Total Competitions</div>
                        </div>
                        <div class="token-stat-card">
                            <div class="token-stat-value" id="active-competitions-stat">0</div>
                            <div class="token-stat-label">Active Now</div>
                        </div>
                        <div class="token-stat-card">
                            <div class="token-stat-value" id="total-participants-stat">0</div>
                            <div class="token-stat-label">Total Participants</div>
                        </div>
                        <div class="token-stat-card">
                            <div class="token-stat-value" id="total-volume-stat">0 SOL</div>
                            <div class="token-stat-label">Total Volume</div>
                        </div>
                    </div>
                </div>
            
                <!-- Competition Controls -->
                <div class="phase2-section">
                    <div class="phase2-badge">Phase 4</div>
                    <h3>üõ†Ô∏è Competition Controls</h3>
                    <div class="cache-controls">
                        <button id="create-competition-btn" class="btn btn-primary">
                            üöÄ Create New Competition
                        </button>
                        <button class="btn btn-secondary" onclick="renderCompetitionsTable()">
                            üîÑ Refresh List
                        </button>
                        <button class="btn btn-info" onclick="viewCompetitionAnalytics()">
                            üìä View Analytics
                        </button>
                    </div>
                </div>
            
                <!-- Enhanced Active Competitions -->
                <div class="competitions-list">
                    <h3>üèÉ Active Competitions</h3>
                    <div class="table-container">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>üÜî ID</th>
                                    <th>ü™ô Tokens</th>
                                    <th>üìä Status</th>
                                    <th>üë• Participants</th>
                                    <th>üí∞ Pool Size</th>
                                    <th>‚è∞ End Time</th>
                                    <th>ü§ñ Type</th>
                                    <th>üõ†Ô∏è Actions</th>
                                </tr>
                            </thead>
                            <tbody id="competitions-tbody">
                                <tr>
                                    <td colspan="8">Loading competitions...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

                <!-- Enhanced Active Competitions -->
                <div class="competitions-list">
                    <h3>üèÉ Active Competitions</h3>
                    <div class="table-container">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>üÜî ID</th>
                                    <th>ü™ô Tokens</th>
                                    <th>üìä Status</th>
                                    <th>üë• Participants</th>
                                    <th>üí∞ Pool Size</th>
                                    <th>‚è∞ End Time</th>
                                    <th>ü§ñ Type</th>
                                    <th>üõ†Ô∏è Actions</th>
                                </tr>
                            </thead>
                            <tbody id="competitions-tbody">
                                <tr>
                                    <td colspan="8">Loading competitions...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Enhanced Token Management Section -->
            <section id="tokens" class="admin-section hidden">
                <h2>ü™ô Enhanced Token Management System</h2>
                
                <!-- Enhanced Token Statistics -->
                <div class="tokens-section">
                    <h3>üìä Real-Time Token Statistics</h3>
                    <div class="token-stats-grid">
                        <div class="token-stat-card">
                            <div class="token-stat-value" id="total-tokens-stat">0</div>
                            <div class="token-stat-label">Total Tokens</div>
                        </div>
                        <div class="token-stat-card">
                            <div class="token-stat-value" id="active-tokens-stat">0</div>
                            <div class="token-stat-label">Active Tokens</div>
                        </div>
                        <div class="token-stat-card">
                            <div class="token-stat-value" id="verified-tokens-stat">0</div>
                            <div class="token-stat-label">Verified Tokens</div>
                        </div>
                        <div class="token-stat-card">
                            <div class="token-stat-value" id="total-market-cap-stat">$0</div>
                            <div class="token-stat-label">Total Market Cap</div>
                        </div>
                        <div class="token-stat-card">
                            <div class="token-stat-value" id="avg-liquidity-stat">0%</div>
                            <div class="token-stat-label">Avg Liquidity</div>
                        </div>
                        <div class="token-stat-card">
                            <div class="token-stat-value" id="blacklisted-tokens-stat">0</div>
                            <div class="token-stat-label">Blacklisted</div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Token Controls -->
                <div class="tokens-section">
                    <h3>üõ†Ô∏è Token Management Controls</h3>
                    <div class="token-controls">
                        <input type="text" id="token-search" class="token-search" 
                               placeholder="üîç Search tokens by symbol, name, or address...">
                        <button id="refresh-tokens-btn" class="btn btn-primary">
                            üîÑ Refresh All Tokens
                        </button>
                        <button id="generate-pairs-btn" class="btn btn-secondary">
                            ‚ö° Generate Smart Pairs
                        </button>
                        <button id="validate-tokens-btn" class="btn btn-warning">
                            ‚úÖ Validate All Tokens
                        </button>
                    </div>
                    
                    <!-- Enhanced Tokens Table -->
                    <div class="table-container" id="tokens-table">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>ü™ô Token</th>
                                    <th>üí∞ Price</th>
                                    <th>üìä Market Cap</th>
                                    <th>üìÖ Age</th>
                                    <th>üíß Liquidity</th>
                                    <th>üîÑ Status</th>
                                    <th>‚úÖ Verification</th>
                                    <th>üïí Updated</th>
                                    <th>üõ†Ô∏è Actions</th>
                                </tr>
                            </thead>
                            <tbody id="tokens-tbody">
                                <tr>
                                    <td colspan="9">Loading tokens...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Analytics Section -->
            <section id="analytics" class="admin-section hidden">
                <h2>üìà Advanced Analytics Dashboard</h2>
                <div class="phase2-section">
                    <h3>Phase 2 Feature</h3>
                    <p>Advanced analytics with custom reports, trend analysis, and predictive insights.</p>
                    <div class="cache-controls">
                        <button class="btn btn-primary" disabled>
                            üìä Generate Report
                        </button>
                        <button class="btn btn-secondary" disabled>
                            üìà Trend Analysis
                        </button>
                        <button class="btn btn-info" disabled>
                            üîÆ Predictive Insights
                        </button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Scripts -->
    <script src="../config.js"></script>
    <script src="../supabase-client.js"></script>
    <script src="../token-service.js"></script>
    <script src="../price-service.js"></script>
    <script src="../competition-manager.js"></script>
    <script src="auth.js"></script>
    <script src="admin.js"></script>
    
    <!-- Phase 2 Component Scripts -->
    <script src="components/cache-monitor.js"></script>
    <script src="components/token-approval.js"></script>
    <script src="components/blacklist-manager.js"></script>
    <script src="components/pair-optimizer.js"></script>
    
    <script>
        // Initialize admin panel on page load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Starting TokenWars Advanced Admin Panel - Phase 2');
            
            // Check if we're authenticated
            const adminToken = sessionStorage.getItem('adminToken');
            if (adminToken) {
                // Skip auth and go straight to admin panel
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('admin-panel').classList.remove('hidden');
                
                // Initialize admin panel
                initializeAdminPanel().catch(error => {
                    console.error('Failed to initialize admin panel:', error);
                });
            }
        });

        // Phase 2 Quick Action Functions
        function quickCacheRefresh() {
            if (window.CacheMonitor) {
                window.CacheMonitor.quickRefresh();
            } else {
                console.log('üîÑ Quick cache refresh triggered');
                showAdminNotification('Cache refresh initiated', 'info');
            }
        }
        
        function viewPendingApprovals() {
            switchToSection('token-approval');
        }
        
        function reviewBlacklist() {
            switchToSection('blacklist-management');
        }
        
        function optimizePairs() {
            switchToSection('pair-optimization');
        }

        // Cache Management Functions
        function refreshTokenCache() {
            console.log('ü™ô Refreshing token cache...');
            showAdminNotification('Token cache refresh started', 'info');
        }
        
        function refreshPriceCache() {
            console.log('üí∞ Refreshing price cache...');
            showAdminNotification('Price cache refresh started', 'info');
        }
        
        function invalidateCache(type) {
            const confirmMsg = type === 'all' ? 
                '‚ö†Ô∏è Clear ALL cache data? This will temporarily slow responses.' :
                'üéØ Selectively invalidate cache entries?';
            
            if (confirm(confirmMsg)) {
                console.log(`üóëÔ∏è Invalidating ${type} cache...`);
                showAdminNotification(`${type} cache invalidation started`, 'warning');
            }
        }
        
        function optimizeCache() {
            console.log('‚ö° Optimizing cache performance...');
            showAdminNotification('Cache optimization started', 'info');
        }

        // Background Job Functions
        function startBackgroundJobs() {
            console.log('‚ñ∂Ô∏è Starting background jobs...');
            showAdminNotification('Background jobs started', 'success');
        }
        
        function pauseBackgroundJobs() {
            console.log('‚è∏Ô∏è Pausing background jobs...');
            showAdminNotification('Background jobs paused', 'warning');
        }
        
        function stopBackgroundJobs() {
            if (confirm('‚ö†Ô∏è Stop all background jobs? This will disable automatic updates.')) {
                console.log('‚èπÔ∏è Stopping background jobs...');
                showAdminNotification('Background jobs stopped', 'error');
            }
        }
        
        function viewJobLogs() {
            console.log('üìã Opening job logs...');
            // Implementation will show modal with job logs
        }

        // Token Approval Functions
        function batchApprove() {
            const selectedCount = document.getElementById('selected-count').textContent;
            if (confirm(`‚úÖ Approve ${selectedCount} selected tokens?`)) {
                console.log('‚úÖ Batch approving tokens...');
                showAdminNotification(`Approving ${selectedCount} tokens`, 'success');
            }
        }
        
        function batchReject() {
            const selectedCount = document.getElementById('selected-count').textContent;
            if (confirm(`‚ùå Reject ${selectedCount} selected tokens?`)) {
                console.log('‚ùå Batch rejecting tokens...');
                showAdminNotification(`Rejecting ${selectedCount} tokens`, 'warning');
            }
        }
        
        function selectAll() {
            console.log('üóÇÔ∏è Selecting all tokens...');
            document.getElementById('selected-count').textContent = '12';
        }
        
        function clearSelection() {
            console.log('üóëÔ∏è Clearing selection...');
            document.getElementById('selected-count').textContent = '0';
        }
        
        function bulkAnalyze() {
            console.log('üîç Running bulk token analysis...');
            showAdminNotification('Bulk analysis started', 'info');
        }

        // Auto-Approval Rules
        function saveAutoApprovalRules() {
            console.log('üíæ Saving auto-approval rules...');
            showAdminNotification('Auto-approval rules saved', 'success');
        }
        
        function testAutoApprovalRules() {
            console.log('üß™ Testing auto-approval rules...');
            showAdminNotification('Testing rules against current tokens', 'info');
        }
        
        function resetAutoApprovalRules() {
            if (confirm('üîÑ Reset all rules to default values?')) {
                console.log('üîÑ Resetting to defaults...');
                showAdminNotification('Rules reset to defaults', 'warning');
            }
        }

        // Blacklist Management Functions
        function bulkBlacklist() {
            console.log('üö´ Opening bulk blacklist interface...');
        }
        
        function bulkWhitelist() {
            console.log('‚úÖ Opening bulk whitelist interface...');
        }
        
        function reviewAppeals() {
            console.log('‚öñÔ∏è Opening appeals review interface...');
        }
        
        function exportBlacklist() {
            console.log('üì§ Exporting blacklist data...');
            showAdminNotification('Blacklist export started', 'info');
        }
        
        function scanForThreats() {
            console.log('üîç Scanning for new threats...');
            showAdminNotification('Threat scan initiated', 'info');
        }

        // Pair Optimization Functions
        function generateOptimalPairs() {
            console.log('‚ö° Generating optimal pairs...');
            showAdminNotification('Optimal pair generation started', 'info');
        }
        
        function testPairCombination() {
            console.log('üß™ Testing pair combination...');
            showAdminNotification('Testing pair combination', 'info');
        }
        
        function saveOptimizationSettings() {
            console.log('üíæ Saving optimization settings...');
            showAdminNotification('Optimization settings saved', 'success');
        }
        
        function resetToDefaults() {
            if (confirm('üîÑ Reset all optimization settings to defaults?')) {
                console.log('üîÑ Resetting optimization settings...');
                showAdminNotification('Settings reset to defaults', 'warning');
            }
        }
        
        function runABTest() {
            console.log('üéØ Starting A/B test...');
            showAdminNotification('A/B test initiated', 'info');
        }
        
        function viewFeedbackData() {
            console.log('üìä Opening feedback data...');
        }
        
        function integrateFeedback() {
            console.log('üîÑ Integrating community feedback...');
            showAdminNotification('Feedback integration started', 'info');
        }

        // Slider value updates
        document.addEventListener('input', function(e) {
            if (e.target.classList.contains('optimization-slider')) {
                const valueDisplay = document.getElementById(e.target.id + '-value');
                if (valueDisplay) {
                    let value = e.target.value;
                    let suffix = '';
                    
                    // Format based on slider type
                    if (e.target.id.includes('market-cap')) {
                        suffix = 'M';
                        value = '$' + value + 'M';
                    } else if (e.target.id.includes('age')) {
                        suffix = ' days';
                        value = value + suffix;
                    } else if (e.target.id.includes('liquidity') || e.target.id.includes('sensitivity')) {
                        suffix = '%';
                        value = value + suffix;
                    } else if (e.target.id.includes('feedback-count')) {
                        value = value + ' votes';
                    }
                    
                    valueDisplay.textContent = value;
                }
            }
        });

        console.log('‚úÖ Enhanced Admin Panel HTML loaded - Phase 2 ready');
        console.log('üöÄ Phase 2 Features:');
        console.log('   üîß Advanced Cache Management Interface');
        console.log('   ‚úÖ Token Approval Workflow System');
        console.log('   üö´ Enhanced Blacklist Management');
        console.log('   ‚ö° Token Pair Optimization Engine');
        console.log('   üìä Real-time Analytics and Monitoring');
    </script>
</body>
</html>
