<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TokenWars - Predict. Compete. Win.</title>
    
    <!-- Preload Critical Resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚öîÔ∏è</text></svg>">
</head>
<body>
    <!-- Animated Background -->
    <div class="animated-background"></div>
    <div class="geometric-patterns"></div>
    
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="#home" class="logo" onclick="showPage('home'); return false;">
                <span>TokenWars</span>
            </a>
            
            <ul class="nav-links">
                <li><a href="#home" class="nav-link active" data-page="home" onclick="showPage('home'); return false;">Home</a></li>
                <li><a href="#competitions" class="nav-link" data-page="competitions" onclick="showPage('competitions'); return false;">Competitions</a></li>
                <li><a href="#leaderboard" class="nav-link" data-page="leaderboard" onclick="showPage('leaderboard'); return false;">Leaderboard</a></li>
                <li><a href="#portfolio" class="nav-link" data-page="portfolio" onclick="showPage('portfolio'); return false;">Portfolio</a></li>
                <li><a href="#guide" class="nav-link" onclick="openPlatformGuide(); return false;">Platform Guide</a></li>
            </ul>
            
            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-toggle" aria-expanded="false">
                <span></span>
                <span></span>
                <span></span>
            </button>
            
            <!-- Wallet Connection -->
            <button id="connectWalletBtn" class="btn-primary" onclick="openWalletModal()">
                <i class="fas fa-wallet"></i> Connect Wallet
            </button>
            
            <!-- Trader Info (Hidden by default) -->
            <div id="traderInfo" style="display: none;">
                <div class="trader-info-display">
                    <div class="trader-avatar">
                        <span id="navTraderAvatar">üéØ</span>
                    </div>
                    <div class="trader-details">
                        <div class="trader-name" id="navTraderName">Trader</div>
                    </div>
                </div>
                <button class="nav-disconnect" onclick="disconnectWallet()">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content Container -->
    <div class="page-container">
        
        <!-- Home Page -->
        <section id="homePage" class="page-content active">
            <!-- Hero Section for Disconnected Users -->
            <div id="heroDisconnected" class="hero">
                <div class="hero-content">
                    <h1 class="hero-title">TokenWars</h1>
                    <p class="hero-motto">Predict. Compete. Win.</p>
                    
                    <div class="cta-buttons">
                        <button class="btn-hero-primary" onclick="openWalletModal()">
                            <i class="fas fa-wallet"></i> Get Started
                        </button>
                        <button class="btn-secondary" onclick="scrollToLearnMore()">
                            <i class="fas fa-info-circle"></i> Learn More
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Hero Section for Connected Users -->
            <div id="heroConnected" class="hero" style="display: none;">
                <div class="hero-content">
                    <h1 class="hero-title">Welcome Back, <span id="heroTraderNameText">Trader</span>!</h1>
                    <p class="hero-motto">Ready to dominate the markets?</p>
                    
                    <div class="cta-buttons">
                        <button class="btn-hero-primary" onclick="showPage('competitions')">
                            <i class="fas fa-trophy"></i> View Competitions
                        </button>
                        <button class="btn-secondary" onclick="showPage('portfolio')">
                            <i class="fas fa-chart-line"></i> My Portfolio
                        </button>
                    </div>
                    
                    <!-- Quick Stats -->
                    <div class="hero-stats">
                        <div class="hero-stat">
                            <div class="stat-value" id="homeWinnings">0 SOL</div>
                            <div class="stat-label">Total Winnings</div>
                        </div>
                        <div class="hero-stat">
                            <div class="stat-value" id="homeWinRate">0%</div>
                            <div class="stat-label">Win Rate</div>
                        </div>
                        <div class="hero-stat">
                            <div class="stat-value" id="homeTotalBets">0</div>
                            <div class="stat-label">Total Bets</div>
                        </div>
                        <div class="hero-stat">
                            <div class="stat-value" id="homeStreak">0</div>
                            <div class="stat-label">Current Streak</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Learn More Section -->
            <section id="learnMoreSection" class="learn-more-section">
                <div class="container">
                    <div class="section-header">
                        <h2 class="section-title">How TokenWars Works</h2>
                        <p class="section-description">
                            Experience the future of crypto prediction markets with our streamlined platform
                        </p>
                    </div>
                    
                    <div class="info-cards-grid">
                        <div class="info-card">
                            <span class="card-icon">üéØ</span>
                            <h3>1. Choose Your Battle</h3>
                            <p>Select from live token competitions featuring the hottest crypto assets. Each battle pits two tokens against each other in a performance showdown.</p>
                        </div>
                        
                        <div class="info-card">
                            <span class="card-icon">üí∞</span>
                            <h3>2. Place Your Prediction</h3>
                            <p>Predict which token will outperform during the competition period. Stake SOL on your choice and join other traders in the battle.</p>
                        </div>
                        
                        <div class="info-card">
                            <span class="card-icon">‚ö°</span>
                            <h3>3. Watch Live Performance</h3>
                            <p>Follow real-time price movements and performance metrics as the competition unfolds. Track your position on the leaderboard.</p>
                        </div>
                        
                        <div class="info-card">
                            <span class="card-icon">üèÜ</span>
                            <h3>4. Claim Your Rewards</h3>
                            <p>Winners share the prize pool based on their predictions. Automatic payouts ensure you receive your rewards instantly when competitions end.</p>
                        </div>
                    </div>
                </div>
            </section>
        </section>

        <!-- Competitions Page -->
        <section id="competitionsPage" class="page-content">
            <!-- Disconnected State -->
            <div id="competitionsDisconnected" class="container">
                <div class="section-header">
                    <h2 class="section-title">Live Competitions</h2>
                    <p class="section-description">Connect your wallet to participate in token prediction battles</p>
                </div>
                
                <div class="connect-wallet-prompt">
                    <div class="prompt-icon">üîó</div>
                    <h3>Connect Wallet to Compete</h3>
                    <p>Join the battle and compete against other traders in live token prediction markets</p>
                    <button class="btn-primary" onclick="openWalletModal()">
                        <i class="fas fa-wallet"></i> Connect Wallet
                    </button>
                </div>
            </div>
            
            <!-- Connected State -->
            <div id="competitionsConnected" class="container" style="display: none;">
                <!-- Header Section -->
                <div class="section-header">
                    <h2 class="section-title">Live Competitions</h2>
                    <p class="section-description">
                        Choose your battles and predict winning tokens in real-time competitions
                    </p>
                    
                    <!-- Filters -->
                    <div class="section-filters">
                        <select id="competition-phase" class="filter-select">
                            <option value="all">All Phases</option>
                            <option value="voting">Voting Phase</option>
                            <option value="active">Active Competitions</option>
                        </select>
                        
                        <select id="sort-by" class="filter-select">
                            <option value="time_remaining">Time Remaining</option>
                            <option value="total_pool">Prize Pool</option>
                            <option value="total_bets">Participants</option>
                            <option value="created_at">Newest First</option>
                        </select>
                        
                        <button class="clear-filters" onclick="clearAllFilters()" style="display: none;">
                            <span class="clear-icon">‚úï</span> Clear Filters
                        </button>
                    </div>
                </div>
                
                <!-- Competition Stats -->
                <div class="competition-status-summary">
                    <div class="status-cards">
                        <div class="status-card voting">
                            <div class="status-icon">üó≥Ô∏è</div>
                            <div class="status-content">
                                <div class="status-count" id="votingCompetitionsCount">0</div>
                                <div class="status-label">Voting</div>
                                <div class="status-desc">Accept predictions</div>
                            </div>
                        </div>
                        
                        <div class="status-card active">
                            <div class="status-icon">‚ö°</div>
                            <div class="status-content">
                                <div class="status-count" id="activeCompetitionsCount">0</div>
                                <div class="status-label">Active</div>
                                <div class="status-desc">Live competitions</div>
                            </div>
                        </div>
                        
                        <div class="status-card total">
                            <div class="status-icon">üèÜ</div>
                            <div class="status-content">
                                <div class="status-count" id="totalCompetitionsCount">0</div>
                                <div class="status-label">Total</div>
                                <div class="status-desc">All competitions</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Competitions Grid -->
                <div id="activeGrid" class="competitions-grid">
                    <!-- Competition cards will be inserted here -->
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Loading live competitions...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Leaderboard Page -->
        <section id="leaderboardPage" class="page-content">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">Leaderboard</h2>
                    <p class="section-description">Top traders and competition results</p>
                </div>
                
                <div id="leaderboard-content">
                    <div class="connect-wallet-prompt">
                        <div class="prompt-icon">üèÜ</div>
                        <h3>Connect Wallet to View Leaderboard</h3>
                        <p>See where you rank among top traders and view competition results</p>
                        <button class="btn-primary" onclick="openWalletModal()">
                            <i class="fas fa-wallet"></i> Connect Wallet
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Portfolio Page -->
        <section id="portfolioPage" class="page-content">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">Portfolio</h2>
                    <p class="section-description">Your trading history and statistics</p>
                    
                    <!-- Portfolio View Selector -->
                    <div class="portfolio-controls" style="display: none;">
                        <select id="portfolio-view" class="filter-select" onchange="handlePortfolioViewChange()">
                            <option value="overview">Overview</option>
                            <option value="history">Betting History</option>
                            <option value="statistics">Statistics</option>
                            <option value="achievements">Achievements</option>
                        </select>
                        
                        <button class="btn-secondary" onclick="refreshPortfolioData()">
                            <i class="fas fa-refresh"></i> Refresh
                        </button>
                    </div>
                </div>
                
                <div id="portfolio-content">
                    <div class="connect-wallet-prompt">
                        <div class="prompt-icon">üìä</div>
                        <h3>Connect Wallet to View Portfolio</h3>
                        <p>Track your prediction history, performance, and earnings</p>
                        <button class="btn-primary" onclick="openWalletModal()">
                            <i class="fas fa-wallet"></i> Connect Wallet
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Wallet Connection Modal -->
    <div id="walletModal" class="wallet-modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Connect Wallet</h2>
                <p id="modalSubtitle">Choose your preferred Solana wallet to get started</p>
                <button class="close-button" onclick="closeWalletModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Step Indicators -->
            <div class="step-indicators">
                <div class="step-indicator active" id="step1Indicator">
                    <div class="step-number">1</div>
                    <div class="step-label">Connect</div>
                </div>
                <div class="step-indicator" id="step2Indicator">
                    <div class="step-number">2</div>
                    <div class="step-label">Confirm</div>
                </div>
                <div class="step-indicator" id="step3Indicator">
                    <div class="step-number">3</div>
                    <div class="step-label">Profile</div>
                </div>
                <div class="step-indicator" id="step4Indicator">
                    <div class="step-number">4</div>
                    <div class="step-label">Complete</div>
                </div>
            </div>
            
            <!-- Step 1: Wallet Selection -->
            <div id="step1Content" class="step-content active">
                <div class="wallet-options">
                    <div class="wallet-option" onclick="selectWallet('phantom')">
                        <div class="wallet-icon">
                            <img src="https://phantom.app/img/phantom-logo.png" alt="Phantom" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                            <div class="fallback-icon" style="display: none;">üëª</div>
                        </div>
                        <div class="wallet-info">
                            <h4>Phantom</h4>
                            <p>Secure wallet for DeFi & NFTs</p>
                        </div>
                        <div class="wallet-status" id="phantomStatus">‚úì Available</div>
                    </div>
                    
                    <div class="wallet-option" onclick="selectWallet('solflare')">
                        <div class="wallet-icon">
                            <img src="https://solflare.com/assets/solflare-logo.svg" alt="Solflare" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                            <div class="fallback-icon" style="display: none;">üî•</div>
                        </div>
                        <div class="wallet-info">
                            <h4>Solflare</h4>
                            <p>Popular Solana wallet</p>
                        </div>
                        <div class="wallet-status" id="solflareStatus">‚úì Available</div>
                    </div>
                    
                    <div class="wallet-option" onclick="selectWallet('backpack')">
                        <div class="wallet-icon">
                            <div class="fallback-icon">üéí</div>
                        </div>
                        <div class="wallet-info">
                            <h4>Backpack</h4>
                            <p>Modern Solana wallet</p>
                        </div>
                        <div class="wallet-status" id="backpackStatus">‚úì Available</div>
                    </div>
                    
                    <div class="wallet-option demo" onclick="selectWallet('demo')">
                        <div class="wallet-icon">
                            <div class="fallback-icon">üéØ</div>
                        </div>
                        <div class="wallet-info">
                            <h4>Demo Mode</h4>
                            <p>Try without a wallet (limited features)</p>
                        </div>
                        <div class="wallet-status" id="demoStatus">‚úì Available</div>
                    </div>
                </div>
            </div>
            
            <!-- Step 2: Connecting -->
            <div id="step2Content" class="step-content">
                <div class="connecting-state">
                    <div class="connecting-animation">
                        <div class="pulse-circle"></div>
                        <div class="wallet-icon-large">
                            <span id="connectingWalletIcon">üîó</span>
                        </div>
                    </div>
                    <h3>Connecting to <span id="selectedWalletName">Wallet</span></h3>
                    <p>Please approve the connection in your wallet extension</p>
                    <div class="connecting-tips">
                        <p><i class="fas fa-info-circle"></i> Check for popup blockers</p>
                        <p><i class="fas fa-shield-alt"></i> Your keys never leave your wallet</p>
                    </div>
                    <button class="btn-secondary" onclick="goToStep(1)">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                </div>
            </div>
            
            <!-- Step 3: Profile Creation -->
            <div id="step3Content" class="step-content">
                <div class="profile-creation">
                    <h3>Create Your Trader Profile</h3>
                    <p>Customize your identity for the leaderboards</p>
                    
                    <div class="profile-form">
                        <div class="form-group">
                            <label for="traderUsername">Username</label>
                            <div class="input-group">
                                <input type="text" 
                                       id="traderUsername" 
                                       placeholder="Enter username" 
                                       maxlength="20"
                                       autocomplete="off"
                                       oninput="validateUsernameInput()"
                                       onblur="validateUsernameInput()">
                                <span class="input-status" id="inputStatus"></span>
                            </div>
                            <small>3-20 characters, letters, numbers, and underscores only</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Choose Your Avatar</label>
                            <div class="avatar-grid">
                                <div class="avatar-option-modern selected" data-avatar="üéØ" onclick="selectAvatar('üéØ')">üéØ</div>
                                <div class="avatar-option-modern" data-avatar="üöÄ" onclick="selectAvatar('üöÄ')">üöÄ</div>
                                <div class="avatar-option-modern" data-avatar="‚ö°" onclick="selectAvatar('‚ö°')">‚ö°</div>
                                <div class="avatar-option-modern" data-avatar="ü¶ä" onclick="selectAvatar('ü¶ä')">ü¶ä</div>
                                <div class="avatar-option-modern" data-avatar="üê∫" onclick="selectAvatar('üê∫')">üê∫</div>
                                <div class="avatar-option-modern" data-avatar="ü¶Ö" onclick="selectAvatar('ü¶Ö')">ü¶Ö</div>
                                <div class="avatar-option-modern" data-avatar="üêâ" onclick="selectAvatar('üêâ')">üêâ</div>
                                <div class="avatar-option-modern" data-avatar="üîÆ" onclick="selectAvatar('üîÆ')">üîÆ</div>
                            </div>
                        </div>
                        
                        <div class="profile-preview">
                            <div class="preview-card">
                                <div class="preview-avatar" id="previewAvatar">üéØ</div>
                                <div class="preview-name" id="previewName">Trader Username</div>
                            </div>
                        </div>
                        
                        <button id="createProfileBtn" class="btn-primary" onclick="goToStep(4)" disabled>
                            Continue <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Step 4: Terms & Completion -->
            <div id="step4Content" class="step-content">
                <div class="terms-completion">
                    <h3>Almost Ready!</h3>
                    <p>Review the terms and complete your setup</p>
                    
                    <div class="terms-section">
                        <div class="agreement-checkbox" id="agreementCheckbox" onclick="toggleAgreement()">
                            <div class="checkbox-mark">‚úì</div>
                        </div>
                        <div class="agreement-text">
                            <p>I agree to the <a href="#" onclick="openPlatformGuide(); return false;">Terms of Service</a> and understand that:</p>
                            <ul>
                                <li>Trading involves risk and I can lose my investment</li>
                                <li>Platform takes a 15% fee from prize pools</li>
                                <li>All transactions are final and irreversible</li>
                                <li>I am responsible for my wallet security</li>
                            </ul>
                        </div>
                    </div>
                    
                    <button id="finalizeBtn" class="btn-primary" onclick="finalizeProfile()" disabled>
                        Complete Setup <i class="fas fa-check"></i>
                    </button>
                </div>
            </div>
            
            <!-- Step 5: Success -->
            <div id="step5Content" class="step-content">
                <div class="success-state">
                    <div class="success-animation">
                        <div class="success-checkmark">‚úì</div>
                    </div>
                    <h3>Welcome to TokenWars!</h3>
                    <p>Your profile has been created successfully</p>
                    <div class="success-actions">
                        <button class="btn-primary" onclick="completedOnboarding()">
                            Start Trading <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Competition Modal -->
    <div id="competitionModal" class="competition-modal hidden">
        <div class="competition-modal-content">
            <div class="modal-header">
                <h2 id="competitionModalTitle">Competition Details</h2>
                <button class="close-button" onclick="closeCompetitionModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Token Information -->
            <div class="modal-tokens-section">
                <div class="modal-token-card">
                    <img id="modalTokenALogo" src="" alt="Token A" class="modal-token-logo">
                    <h3 id="modalTokenASymbol">TOKEN</h3>
                    <p id="modalTokenAName">Token Name</p>
                    <div class="token-price" id="modalTokenAPrice">$0.00</div>
                    <div class="price-change" id="modalTokenAChange">0%</div>
                </div>
                
                <div class="modal-vs">VS</div>
                
                <div class="modal-token-card">
                    <img id="modalTokenBLogo" src="" alt="Token B" class="modal-token-logo">
                    <h3 id="modalTokenBSymbol">TOKEN</h3>
                    <p id="modalTokenBName">Token Name</p>
                    <div class="token-price" id="modalTokenBPrice">$0.00</div>
                    <div class="price-change" id="modalTokenBChange">0%</div>
                </div>
            </div>
            
            <!-- Competition Stats -->
            <div class="modal-stats">
                <div class="stat-item">
                    <div class="stat-value" id="modalParticipants">0</div>
                    <div class="stat-label">Participants</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="modalPrizePool">0 SOL</div>
                    <div class="stat-label">Prize Pool</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="modalTimeRemaining">0</div>
                    <div class="stat-label">Time Remaining</div>
                </div>
            </div>
            
            <!-- Betting Interface -->
            <div id="bettingInterface" class="betting-interface">
                <div class="betting-title">Place Your Prediction</div>
                
                <div class="token-choice-buttons">
                    <button id="choiceTokenA" class="token-choice-button" onclick="selectToken('A')">
                        <div class="token-symbol" id="choiceTokenASymbol">TOKEN A</div>
                        <div class="bet-button-label">Choose This Token</div>
                    </button>
                    
                    <button id="choiceTokenB" class="token-choice-button" onclick="selectToken('B')">
                        <div class="token-symbol" id="choiceTokenBSymbol">TOKEN B</div>
                        <div class="bet-button-label">Choose This Token</div>
                    </button>
                </div>
                
                <div class="bet-amount-section">
                    <label for="betAmount">Bet Amount (SOL)</label>
                    <input type="number" 
                           id="betAmount" 
                           class="bet-amount-input" 
                           min="0.1" 
                           step="0.1" 
                           value="0.1"
                           placeholder="0.1">
                </div>
                
                <button id="placeBetButton" class="place-bet-button" onclick="placeBet()" disabled>
                    Select a token to continue
                </button>
            </div>
        </div>
    </div>

    <!-- Platform Guide Modal -->
    <div id="platformGuideModal" class="platform-guide-modal hidden">
        <div class="guide-modal-content">
            <button class="guide-close-button" onclick="closePlatformGuide()">√ó</button>
            <div id="guideContent" class="guide-content">
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>Loading platform guide...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- System Status Indicators (for debugging) -->
    <div id="systemStatus" class="system-status" style="display: none;">
        <div id="dbStatus" class="db-status disconnected">‚ùå Database: Connecting...</div>
        <div id="tokenStatus" class="db-status disconnected">‚ùå Tokens: Loading...</div>
    </div>

    <!-- External Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Application Scripts - CORRECTED ORDER -->
    <script src="config.js"></script>
    <script src="supabase-client.js"></script>
    <script src="wallet-service.js"></script>
    <script src="user.js"></script>
    <script src="competition.js"></script>
    <script src="app.js"></script>
    
    <!-- Initialize Application -->
    <script>
        // Ensure proper initialization order
        console.log('üöÄ TokenWars starting...');
        
        // Wait for DOM to be fully loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                console.log('üì± DOM loaded, initializing TokenWars...');
            });
        } else {
            console.log('üì± DOM already loaded');
        }
    </script>
</body>
</html>
